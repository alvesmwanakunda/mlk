<app-navbar>
  <div class="container">
    <div class="content-top">
      <div class="row">
        <div class="col">
          <p class="title-projet-page">Entreprise : {{entreprise?.societe}} <button class="btn" type="button" (click)="getDetail(entreprise._id)"><i class="fa-solid fa-arrow-left" style="color:#28628B;"></i></button></p>
        </div>
        <div class="col">
           <div align="right">
            <i class="fa-solid fa-city" style="font-size: 30px;color: #666C7E;"></i>
           </div>
        </div>
      </div><!--row-->
      <div class="row">
        <div class="col">
          <hr class="entreprise">
        </div>
      </div><!--row-->
      <div class="row" >
        <div class="col">
          <mat-stepper orientation="vertical" *ngIf="entreprise">
            <mat-step [stepControl]="firstFormGroup" errorMessage="Le nom d'entreprise est obligatoire.">
              <form [formGroup]="firstFormGroup">
                <ng-template matStepLabel>Informations Primaires de l’entreprise</ng-template>
                <ng-template matStepContent>
                  <div class="row">
                    <div class="col">

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Sociéte</mat-label>
                          <input matInput formControlName="societe" [(ngModel)]="entreprise.societe" readonly required>
                        </mat-form-field>
                        <div *ngIf="firstFormGroup.get('societe').hasError(champ_validation.input[0].type) && (firstFormGroup.get('societe').dirty || firstFormGroup.get('societe').touched)">
                          <p class="error_field">{{champ_validation.input[0].message}}</p>
                        </div>
                      </div><!--div-->

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Nº SIREN</mat-label>
                          <input matInput formControlName="siren" [(ngModel)]="entreprise.siren">
                        </mat-form-field>
                      </div><!--div-->
                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Forme Juridique</mat-label>
                          <input matInput formControlName="juridique" [(ngModel)]="entreprise.juridique">
                        </mat-form-field>
                      </div><!--div-->

                    </div><!--col-->
                    <div class="col">

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Nom Commercial</mat-label>
                          <input matInput formControlName="commercial" [(ngModel)]="entreprise.commercial">
                        </mat-form-field>
                      </div><!--div-->
                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Nº SIRET</mat-label>
                          <input matInput formControlName="siret" [(ngModel)]="entreprise.siret">
                        </mat-form-field>
                      </div><!--div-->
                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Nº TVA</mat-label>
                          <input matInput formControlName="tva" [(ngModel)]="entreprise.tva">
                        </mat-form-field>
                      </div><!--div-->
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <div style="margin-bottom: 15px;">
                       <mat-form-field class="example-full-width">
                        <mat-label>Type d'entreprise</mat-label>
                        <mat-select matInput formControlName="type_entreprise"  [(ngModel)]="entreprise.type_entreprise">
                          <mat-option value="Privé">Privé</mat-option>
                          <mat-option value="Public">Public</mat-option>
                          <mat-option value="Association">Association</mat-option>
                        </mat-select>
                      </mat-form-field>
                      </div><!--div-->
                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Source</mat-label>
                          <mat-select matInput formControlName="source" [(ngModel)]="entreprise.source">
                          <mat-option value="Plateforme Référencement">Plateforme Référencement</mat-option>
                          <mat-option value="Partenaires">Partenaires</mat-option>
                          <mat-option value="Bouche à l'oreille">Bouche à l'oreille</mat-option>
                          <mat-option value="Réseau professionnel">Réseau professionnel</mat-option>
                          <mat-option value="Salons & Evenements">Salons & Evenements</mat-option>
                          <mat-option value="Digital">Digital</mat-option>
                          <mat-option value="Emailing">Emailing</mat-option>
                          <mat-option value="Containex">Containex</mat-option>
                          <mat-option value="Tepe">Tepe</mat-option>
                          <mat-option value="Autres fournisseurs">Autres fournisseurs</mat-option>
                          <mat-option value="David BAERT">David BAERT</mat-option>
                          <mat-option value="Autres">Autres</mat-option>
                         </mat-select>
                        </mat-form-field>
                          
                      </div><!--div-->
                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Categorie societe</mat-label>
                          <mat-select formControlName="categorie_societe" [(ngModel)]="entreprise.categorie_societe">
                            <mat-option value="Prospect">Prospect</mat-option>
                            <mat-option value="Fournisseur">Fournisseur</mat-option>
                            <mat-option value="Partenaire">Partenaire</mat-option>
                            <mat-option value="Client">Client</mat-option>
                            <mat-option value="Autre">Autre</mat-option>
                         </mat-select>
                        </mat-form-field>
                       
                      </div><!--div-->
                    </div>
                  </div>
                  <div style="margin-bottom: 15px;">
                    <mat-form-field class="example-full-width">
                      <mat-label>Activité Principale</mat-label>
                      <input matInput  formControlName="activite" [(ngModel)]="entreprise.activite">
                    </mat-form-field>
                  </div><!--div-->
                  <div align="right">
                    <button mat-button matStepperNext class="btn-entreprise">Suivant <i class="fa-solid fa-chevron-right"></i></button>
                  </div>
                </ng-template>
              </form>
            </mat-step>
            <mat-step [stepControl]="secondFormGroup" errorMessage="L'email d'entreprise et téléphone sont obligatoire.">
              <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel>Coordonnées de l'entreprise</ng-template>
                <ng-template matStepContent>
                  <div class="row">
                    <div class="col">

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Activité Principale</mat-label>
                          <input matInput  [(ngModel)]="entreprise.pays" formControlName="pays" [matAutocomplete]="auto">
                          <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngFor="let pays of paysFiltres | async" [value]="pays.name">
                              {{pays?.emoji}} {{pays?.name}}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field> 
                      </div><!--div-->

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Code Postal</mat-label>
                          <input matInput formControlName="postal" [(ngModel)]="entreprise.postal">
                        </mat-form-field>
                      </div><!--div-->

                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Email de l'entreprise</mat-label>
                          <input matInput  formControlName="email" [(ngModel)]="entreprise.email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" required>
                        </mat-form-field>
                        <div *ngIf="secondFormGroup.get('email').hasError(champ_validation.email[0].type) && (secondFormGroup.get('email').dirty || secondFormGroup.get('email').touched)">
                          <p class="error_field">{{champ_validation.email[0].message}}</p>
                        </div>
                        <div *ngIf="secondFormGroup.get('email').hasError(champ_validation.email[1].type) && (secondFormGroup.get('email').dirty || secondFormGroup.get('email').touched)">
                          <p class="error_field">{{champ_validation.email[1].message}}</p>
                        </div>
                      </div><!--div-->

                    </div><!--col-->
                    <div class="col">


                      <div style="margin-bottom: 15px;">
                        <mat-form-field class="example-full-width">
                          <mat-label>Adresse de l'entreprise</mat-label>
                          <input matInput formControlName="rue" [(ngModel)]="entreprise.rue">
                        </mat-form-field>
                      </div><!--div-->

                      <div class="row" style="margin-bottom: 15px;">
                        <div class="col">
                            <mat-form-field class="example-full-width">
                              <mat-label>Numéro</mat-label>
                              <input matInput formControlName="numero" [(ngModel)]="entreprise.numero">
                            </mat-form-field>
                        </div>
                        <div class="col">
                            <mat-form-field class="example-full-width">
                              <mat-label>Site Web</mat-label>
                              <input matInput formControlName="site" [(ngModel)]="entreprise.site">
                            </mat-form-field>
                        </div>
                      </div>


                      <div class="row" style="margin-bottom: 15px;">
                        <div class="col-4">
                         <mat-form-field class="example-full-width">
                            <mat-label>Indicatif</mat-label>
                            <input matInput [(ngModel)]="entreprise.indicatif" formControlName="indicatif" [matAutocomplete]="autoCode">
                          </mat-form-field>
                          <mat-autocomplete #autoCode="matAutocomplete">
                            <mat-option *ngFor="let code of codeFiltres | async" [value]="code?.dial_code">
                              {{code?.dial_code}}
                            </mat-option>
                          </mat-autocomplete>
                        </div>
                        <div class="col">
                          <mat-form-field class="example-full-width">
                            <mat-label>Nº Tel</mat-label>
                            <input matInput formControlName="telephone" [(ngModel)]="entreprise.telephone">
                          </mat-form-field>
                          <div *ngIf="secondFormGroup.get('telephone').hasError(champ_validation.telephone[0].type) && (secondFormGroup.get('telephone').dirty || secondFormGroup.get('telephone').touched)">
                            <p class="error_field">{{champ_validation.telephone[0].message}}</p>
                          </div>
                        </div>
                      </div><!--div-->
                    </div>
                  </div>
                  <div class="row" style="margin-bottom: 15px;">
                    <div class="col-2">
                      <mat-form-field class="example-full-width">
                        <mat-label>Genre</mat-label>
                        <mat-select  formControlName="genre" [(ngModel)]="entreprise.genre" aria-label="Default select example">
                          <mat-option value="Mr">Mr</mat-option>
                          <mat-option value="Mme">Mme</mat-option>
                        </mat-select>
                      </mat-form-field>                     
                      <!--<div *ngIf="secondFormGroup.get('genre').hasError(champ_validation.input[0].type) && (secondFormGroup.get('genre').dirty || secondFormGroup.get('genre').touched)">
                        <p class="error_field">{{champ_validation.input[0].message}}</p>
                      </div>-->
                    </div>
                    <div class="col">
                      <mat-form-field class="example-full-width">
                        <mat-label>Nom responsable</mat-label>
                        <input matInput formControlName="nom" [(ngModel)]="entreprise.nom">
                      </mat-form-field>
                      <div *ngIf="secondFormGroup.get('nom').hasError(champ_validation.input[0].type) && (secondFormGroup.get('nom').dirty || secondFormGroup.get('nom').touched)">
                        <p class="error_field">{{champ_validation.input[0].message}}</p>
                      </div>
                    </div>
                    <div class="col">
                    <mat-form-field class="example-full-width">
                      <mat-label>Prénom responsable</mat-label>
                      <input matInput formControlName="prenom" [(ngModel)]="entreprise.prenom">
                    </mat-form-field>
                    <div *ngIf="secondFormGroup.get('prenom').hasError(champ_validation.input[0].type) && (secondFormGroup.get('prenom').dirty || secondFormGroup.get('prenom').touched)">
                      <p class="error_field">{{champ_validation.input[0].message}}</p>
                    </div>
                    </div>

                  </div>
                  <div align="right">
                    <button mat-button matStepperPrevious class="btn-entreprise-back" style="margin-right: 10px;"><i class="fa-solid fa-chevron-left"></i> PRECEDENT</button>
                    <button mat-button matStepperNext class="btn-entreprise">SUIVANT <i class="fa-solid fa-chevron-right"></i></button>
                  </div>
                </ng-template>
              </form>
            </mat-step>
            <mat-step [stepControl]="threeFormGroup">
              <form [formGroup]="threeFormGroup">
                <ng-template matStepLabel>Information Supplémentaires de l'entreprise</ng-template>

                <div class="row" style="padding-top: 13px;">
                  <div class="col-md-3">
                    <div style="margin-bottom: 10px;"  *ngIf="!selectedImage">
                      <div class="card card-dot-blue" *ngIf="!entreprise?.photo">
                        <div class="card-body">
                          <img src="assets/images/galerie.png">
                        </div>
                      </div><!--card-->
                      <img [src]="image" *ngIf="entreprise?.photo" class="card-img-projet">
                    </div>

                    <div *ngIf="selectedImage"  style="margin-bottom: 10px;">
                      <img [src]="selectedImage" class="card-img-projet">
                    </div>
                    <div align="right">
                      <input type="file" class="file-input" accept='image/*' (change)="onFileSelected($event)" #fileUpload>
                      <button type="button" (click)="fileUpload.click()" class="btn btn-projet"><i class="fa-solid fa-cloud-arrow-down"></i> charger</button>
                    </div>
                  </div><!--col-->
                  <div class="col-md-9"></div>
                </div><!--row-->
                <div>
                  <div style="margin-bottom: 15px;">
                    <mat-form-field class="example-full-width">
                      <mat-label>Corps d'activité</mat-label>
                      <input matInput formControlName="corps_act" [(ngModel)]="entreprise.corps_act">
                    </mat-form-field>
                  </div><!--div-->
                  <div style="margin-bottom: 15px;">
                    <mat-form-field class="example-full-width">
                      <mat-label>Corps Etat</mat-label>
                      <input matInput  formControlName="corps_etat" [(ngModel)]="entreprise.corps_etat">
                    </mat-form-field>
                  </div><!--div-->
                  <div style="margin-bottom: 15px;">
                    <mat-form-field class="example-full-width">
                      <mat-label>Fournisseur</mat-label>
                      <mat-select  formControlName="fournisseur" [(ngModel)]="entreprise.fournisseur" aria-label="Default select example">
                        <mat-option value="Oui">Oui</mat-option>
                        <mat-option value="Non">Non</mat-option>
                      </mat-select>
                    </mat-form-field>                    
                  </div><!--div-->
                </div>
              </form>
              <div align="right">
                <button mat-button matStepperPrevious class="btn-entreprise-back" style="margin-right: 10px;"><i class="fa-solid fa-chevron-left"></i> PRECEDENT</button>
                <button mat-button  class="btn-entreprise" (click)="updateEntreprise()" [disabled]="firstFormGroup.invalid || secondFormGroup.invalid">VALIDER</button>
              </div>
            </mat-step>
          </mat-stepper>
          <div *ngIf="onLoadForm">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          </div>

        </div><!--col-->
      </div><!--row-->
    </div>
  </div>
</app-navbar>

